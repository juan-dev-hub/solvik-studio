"use strict";(()=>{var e={};e.id=998,e.ids=[998],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},71017:e=>{e.exports=require("path")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},63995:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>h,originalPathname:()=>O,requestAsyncStorage:()=>g,routeModule:()=>f,serverHooks:()=>q,staticGenerationAsyncStorage:()=>x,staticGenerationBailout:()=>v});var o={};t.r(o),t.d(o,{POST:()=>c}),t(65629);var i=t(70532),a=t(84952),n=t(29622),s=t(26360);let u=require("fs/promises"),d=require("fs");var p=t(71017),l=t.n(p);async function c(e){try{let r=await (0,s.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}()));if(!r?.user?.id)return n.Z.json({error:"No autorizado"},{status:401});let t=await e.formData(),o=t.get("file"),i=t.get("imageType");if(!o)return n.Z.json({error:"No se encontr\xf3 archivo"},{status:400});if(!["image/jpeg","image/png","image/webp"].includes(o.type))return n.Z.json({error:"Tipo de archivo no permitido"},{status:400});if(o.size>10485760)return n.Z.json({error:"Archivo demasiado grande"},{status:400});let a=l().join(process.cwd(),"public","uploads",r.user.id);(0,d.existsSync)(a)||await (0,u.mkdir)(a,{recursive:!0});let p=Date.now(),c=l().extname(o.name),m=`${i}_${p}${c}`,f=l().join(a,m),g=await o.arrayBuffer(),x=Buffer.from(g);await (0,u.writeFile)(f,x);let q=await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).landingPage.findUnique({where:{userId:r.user.id}});if(!q)return n.Z.json({error:"Landing page no encontrada"},{status:404});let h=await Object(function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}()).landingPageImage.create({data:{landingPageId:q.id,imageType:i.toUpperCase(),fileName:m,originalName:o.name,url:`/uploads/${r.user.id}/${m}`,size:o.size,mimeType:o.type}});return n.Z.json({id:h.id,url:h.url,fileName:h.fileName})}catch(e){return console.error("Upload error:",e),n.Z.json({error:"Error interno del servidor"},{status:500})}}(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '@/lib/prisma'");throw e.code="MODULE_NOT_FOUND",e}();let m=i.AppRouteRouteModule,f=new m({definition:{kind:a.x.APP_ROUTE,page:"/api/upload/route",pathname:"/api/upload",filename:"route",bundlePath:"app/api/upload/route"},resolvedPagePath:"/home/project/frontend/app/api/upload/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:g,staticGenerationAsyncStorage:x,serverHooks:q,headerHooks:h,staticGenerationBailout:v}=f,O="/api/upload/route"}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[822,670,360],()=>t(63995));module.exports=o})();